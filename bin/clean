#!/usr/bin/env python3
import click
import git
import os

git_check_subdirs = [
    "~",
    "~/Code",
    "~/Git",
]

allowed_hidden_files = set([
    ".agignore",
    ".aliases",
    ".bash_history",
    ".bash_logout",
    ".bashrc",
    ".cache",
    ".config",
    ".dircolors",
    ".dotfiles",
    ".gitconfig",
    ".gnupg",
    ".inputrc",
    ".local",
    ".mozilla",
    ".password-store",
    ".profile",
    ".ssh",
    ".tmux.conf",
    ".vim",
    ".vimrc",
])

home = os.path.expanduser("~")
hidden_files = [f.name for f in os.scandir(home) if f.name[0] == '.']
extra_files = set(hidden_files) - allowed_hidden_files

if extra_files:
    print("Extra files found:")
    for f in sorted(extra_files):
        print("\t" + f)
else:
    print("No extra files found")


def is_git_project(dirpath):
    return os.path.isdir(os.path.join(dirpath, ".git"))

git_projects = []
for dirname in git_check_subdirs:
    dirname = os.path.expanduser(dirname)
    for de in os.scandir(dirname):
        if de.is_dir() and is_git_project(de.path):
            git_projects.append(de.path)

for project_dir in git_projects:
    repo = git.Repo(project_dir)
    if repo.is_dirty(untracked_files=True):
        print(project_dir + " is dirty")
